<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking Clínicas Dentales Concepción</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function Dashboard() {
            const [showContactForm, setShowContactForm] = useState(false);
            const [reportType, setReportType] = useState('');
            const [selectedClinic, setSelectedClinic] = useState(null);
            const [showClinicModal, setShowClinicModal] = useState(false);
            const [contactData, setContactData] = useState({ name: '', email: '', whatsapp: '', clinicName: '' });
            const [currentPage, setCurrentPage] = useState(1);

            // Datos actualizados - Octubre 2025
            const clinicsData = [
                { id: 1, name: "Clínica Dental San Martín", rating: 5.0, reviews: 106, score: 4.890, rank: 1, acceso: true, familia: false, ortodoncia: true, urgencias: false, horario: "09:00 – 19:00", sabado: "09:00 - 14:00", direccion: "San Martín 450, 4030000 Concepción, Bío Bío" },
                { id: 2, name: "Clínica Bio Bio Dental", rating: 5.0, reviews: 99, score: 4.884, rank: 2, acceso: true, familia: false, ortodoncia: false, urgencias: false, horario: "09:00 - 19:00", sabado: "09:00 - 13:00", direccion: "Barros Arana 531, 4030000 Concepción, Bío Bío" },
                { id: 3, name: "Clínica Dental Brelo - Concepción", rating: 4.9, reviews: 256, score: 4.858, rank: 3, acceso: true, familia: false, ortodoncia: true, urgencias: false, horario: "09:00 - 19:00", sabado: "09:00 - 14:00", direccion: "Cochrane 844, 4030000 Concepción, Bío Bío" },
                { id: 4, name: "CentroDent", rating: 4.9, reviews: 104, score: 4.810, rank: 4, acceso: false, familia: false, ortodoncia: true, urgencias: false, horario: "09:30 - 17:30", sabado: "cerrado", direccion: "Rengo 193, 2º piso, 4030000 Concepción, Bío Bío" },
                { id: 5, name: "Münzenmayer Odontología", rating: 5.0, reviews: 49, score: 4.810, rank: 5, acceso: false, familia: false, ortodoncia: false, urgencias: false, horario: "09:30 - 19:00", sabado: "cerrado", direccion: "Anibal Pinto 131, 4030000 Concepción, Bío Bío" },
                { id: 6, name: "KAI Estudio Dental", rating: 5.0, reviews: 47, score: 4.805, rank: 6, acceso: true, familia: false, ortodoncia: true, urgencias: true, horario: "09:00 - 19:00", sabado: "10:00 - 14:00", direccion: "Rengo 94, oficina 51, 4030000 Concepción, Bío Bío" },
                { id: 7, name: "Dra Carolina Weason", rating: 5.0, reviews: 47, score: 4.805, rank: 7, acceso: false, familia: false, ortodoncia: false, urgencias: false, horario: "No informado", sabado: "No informado", direccion: "Lord Cochrane 815, 4030000 Concepción, Bío Bío" },
                { id: 8, name: "Clinica A+ Salud", rating: 5.0, reviews: 47, score: 4.805, rank: 8, acceso: true, familia: false, ortodoncia: true, urgencias: false, horario: "10:00 - 19:00", sabado: "10:00 - 17:00", direccion: "San Martín 654, Of. 31, 4030000 Concepción, Bío Bío" },
                { id: 9, name: "Clinica Dental - Hola Dental Concepción", rating: 4.9, reviews: 96, score: 4.805, rank: 9, acceso: true, familia: false, ortodoncia: false, urgencias: true, horario: "09:00 - 19:00", sabado: "09:00 - 13:00", direccion: "Tucapel 240, 4030000 Concepción, Bío Bío" },
                { id: 10, name: "URGENCIAS dentales - VR Clínica dental", rating: 5.0, reviews: 43, score: 4.795, rank: 10, acceso: true, familia: true, ortodoncia: false, urgencias: true, horario: "No informado", sabado: "No informado", direccion: "Angol 436, Of. 402, 4030000 Concepción, Bío Bío" },
                { id: 11, name: "Clínica dental Experiencia Bliss", rating: 4.9, reviews: 76, score: 4.787, rank: 11, acceso: false, familia: false, ortodoncia: true, urgencias: true, horario: "09:30 - 20:30", sabado: "10:30 - 14:00", direccion: "Marina de Chile 2889, San Pedro de la Paz, Bío Bío" },
                { id: 12, name: "Clínica Origen - Estudio Dental", rating: 5.0, reviews: 38, score: 4.779, rank: 12, acceso: false, familia: false, ortodoncia: true, urgencias: false, horario: "10:00 - 19:00", sabado: "10:00 - 14:00", direccion: "Cochrane 635, Torre B, 4030000 Concepción, Bío Bío" },
                { id: 13, name: "Clínica KDENT", rating: 5.0, reviews: 34, score: 4.766, rank: 13, acceso: true, familia: true, ortodoncia: false, urgencias: true, horario: "09:00 - 19:00", sabado: "cerrado", direccion: "O'Higgins 630, Of. 403, 4030000 Concepción, Bío Bío" },
                { id: 14, name: "Clinica de Ortodoncia Dr. Pablo Cerda", rating: 4.9, reviews: 58, score: 4.764, rank: 14, acceso: false, familia: false, ortodoncia: true, urgencias: false, horario: "09:00 - 19:00", sabado: "cerrado", direccion: "Barros Arana 162, 4030000 Concepción, Bío Bío" },
                { id: 15, name: "CLINICA DENTAL ALICURA o'higgins", rating: 4.8, reviews: 167, score: 4.754, rank: 15, acceso: true, familia: false, ortodoncia: true, urgencias: true, horario: "08:30 - 19:00", sabado: "09:00 - 14:00", direccion: "Av. O'Higgins 1628, 4030000 Concepción, Bío Bío" },
                { id: 16, name: "Clínica Dental Dra Katherine Adasme Menares", rating: 5.0, reviews: 29, score: 4.746, rank: 16, acceso: true, familia: false, ortodoncia: false, urgencias: false, horario: "09:00 - 20:00", sabado: "09:00 - 20:00", direccion: "Rengo 94, Oficina 41, 4030000 Concepción, Bío Bío" },
                { id: 17, name: "Clínica Doctor Ortodoncia - CDO", rating: 4.9, reviews: 44, score: 4.738, rank: 17, acceso: false, familia: false, ortodoncia: true, urgencias: false, horario: "09:00 - 19:00", sabado: "09:00 - 14:00", direccion: "Barros Arana 492, 4030000 Concepción, Bío Bío" },
                { id: 18, name: "Clínica Dental Uno Salud Angol", rating: 4.8, reviews: 105, score: 4.733, rank: 18, acceso: false, familia: false, ortodoncia: false, urgencias: false, horario: "No informado", sabado: "No informado", direccion: "Angol 453, 4030000 Concepción, Bío Bío" },
                { id: 19, name: "Clínica Dental Mood", rating: 5.0, reviews: 25, score: 4.727, rank: 19, acceso: true, familia: true, ortodoncia: true, urgencias: false, horario: "09:00 - 20:00", sabado: "cerrado", direccion: "Cochrane 678, 4030000 Concepción, Bío Bío" },
                { id: 20, name: "Clínica Odontologica Valinor", rating: 5.0, reviews: 23, score: 4.717, rank: 20, acceso: true, familia: false, ortodoncia: true, urgencias: true, horario: "09:00 - 20:00", sabado: "09:00 - 14:00", direccion: "Barros Arana 1098, 4030000 Concepción, Bío Bío" }
            ];

            const handleContactSubmit = async (e) => {
                e.preventDefault();
                
                const formData = {
                    timestamp: new Date().toISOString(),
                    name: contactData.name,
                    email: contactData.email,
                    whatsapp: contactData.whatsapp,
                    clinicName: contactData.clinicName || selectedClinic?.name || '',
                    reportType: reportType,
                    source: 'dashboard-github-oct2025'
                };

                try {
                    await fetch('https://script.google.com/macros/s/AKfycbyJMrK-cqWbo_bV5lTZloELoLIIqxdkzESTZZc2xfVFSATACIoTRRdELuaEnukVpmdP/exec', {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    alert(`¡Solicitud enviada exitosamente!\n\nRecibirás tu Informe Premium en las próximas 24 horas.\n\nTe contactaremos al WhatsApp: ${contactData.whatsapp}`);
                } catch (error) {
                    alert('Solicitud enviada. Te contactaremos pronto.');
                } finally {
                    setContactData({ name: '', email: '', whatsapp: '', clinicName: '' });
                    setShowContactForm(false);
                    setReportType('');
                }
            };

            const getRankColor = (rank) => {
                if (rank === 1) return 'bg-yellow-500';
                if (rank === 2) return 'bg-gray-400';
                if (rank === 3) return 'bg-amber-600';
                if (rank <= 10) return 'bg-blue-500';
                return 'bg-slate-400';
            };

            const getChangeIndicator = (rank) => {
                const changes = {
                    1: { type: 'up', from: 2, color: 'bg-green-500', icon: '↗️', text: '+1' },
                    2: { type: 'up', from: 3, color: 'bg-green-500', icon: '↗️', text: '+1' },
                    3: { type: 'down', from: 1, color: 'bg-red-400', icon: '↘️', text: '-2' },
                    4: { type: 'up', from: 15, color: 'bg-green-500', icon: '↗️', text: '+11' },
                    13: { type: 'up', from: 14, color: 'bg-green-500', icon: '↗️', text: '+1' },
                    14: { type: 'down', from: 13, color: 'bg-red-400', icon: '↘️', text: '-1' },
                    15: { type: 'up', from: 16, color: 'bg-green-500', icon: '↗️', text: '+1' },
                    16: { type: 'up', from: 17, color: 'bg-green-500', icon: '↗️', text: '+1' },
                    17: { type: 'up', from: 18, color: 'bg-green-500', icon: '↗️', text: '+1' },
                    18: { type: 'up', from: 34, color: 'bg-green-500', icon: '↗️', text: '+16' }
                };
                
                return changes[rank] || { type: 'same', color: 'bg-gray-400', icon: '➡️', text: '=' };
            };

            const renderStars = (rating) => {
                return Array.from({ length: 5 }, (_, i) => (
                    <svg key={i} className={`w-4 h-4 ${i < rating ? 'text-yellow-400' : 'text-gray-300'}`} fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                ));
            };

            const accesoUniversal = clinicsData.filter(c => c.acceso);
            const atencionFamiliar = clinicsData.filter(c => c.familia);
            const ortodoncia = clinicsData.filter(c => c.ortodoncia);
            const urgencias = clinicsData.filter(c => c.urgencias);

            const itemsPerPage = 10;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentClinics = clinicsData.slice(startIndex, endIndex);
            const totalPages = Math.ceil(clinicsData.length / itemsPerPage);

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-16">
                        <div className="max-w-6xl mx-auto px-4 text-center">
                            <h1 className="text-5xl font-bold mb-4">🦷 Ranking Clínicas Dentales</h1>
                            <h2 className="text-3xl mb-6">Concepción, Chile</h2>
                            <div className="bg-white bg-opacity-20 rounded-lg p-6 inline-block">
                                <p className="text-xl font-semibold">📅 Fecha de corte: 12/10/2025</p>
                                <p className="text-xl font-semibold">🔄 Próxima actualización: 27/10/2025</p>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto px-4 py-8">
                        <div className="bg-white rounded-xl shadow-lg p-8 mb-8">
                            <h3 className="text-2xl font-bold mb-4 text-gray-800">📊 Metodología de Ranking</h3>
                            <p className="text-gray-600 text-lg mb-4">
                                Este ranking utiliza un <strong>sistema bayesiano</strong> que combina la valoración promedio de Google Maps 
                                con el número total de reseñas, aplicando un factor de corrección que favorece tanto la calidad como la cantidad de opiniones.
                            </p>
                            <div className="bg-green-50 border-l-4 border-green-400 p-4 mb-6">
                                <p className="text-green-800">
                                    <strong>🔄 Datos en tiempo real:</strong> No almacenamos datos de Google Maps. El cálculo se realiza 
                                    directamente en la fecha de actualización del ranking o en el momento en que solicitas tu informe, 
                                    garantizando que la información sea siempre fresca y actualizada.
                                </p>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div className="bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-4 rounded-lg">
                                    <div className="flex items-center space-x-2">
                                        <span className="text-2xl">🏆</span>
                                        <div>
                                            <p className="font-bold text-lg">NUEVO LÍDER</p>
                                            <p className="text-sm">Clínica Dental San Martín (#2 → #1)</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg">
                                    <div className="flex items-center space-x-2">
                                        <span className="text-2xl">📈</span>
                                        <div>
                                            <p className="font-bold text-lg">MAYOR ASCENSO</p>
                                            <p className="text-sm">Uno Salud Angol (+16 posiciones)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="bg-blue-50 border-l-4 border-blue-400 p-4">
                                <p className="text-blue-800">
                                    <strong>🔄 Actualización Octubre 2025:</strong> El ranking muestra cambios significativos 
                                    con nuevo líder. Clínica Dental San Martín asciende al #1, mientras que CentroDent 
                                    sorprende con un ascenso de 11 posiciones (#15 → #4).
                                </p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div className="bg-white p-6 rounded-xl shadow-lg text-center">
                                <div className="text-4xl font-bold text-blue-600 mb-2">160</div>
                                <div className="text-gray-600 font-medium">Clínicas Analizadas</div>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-lg text-center">
                                <div className="text-4xl font-bold text-green-600 mb-2">1,493</div>
                                <div className="text-gray-600 font-medium">Total Reviews</div>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-lg text-center">
                                <div className="text-4xl font-bold text-yellow-600 mb-2">5.0</div>
                                <div className="text-gray-600 font-medium">Rating Promedio</div>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-lg text-center">
                                <div className="text-4xl font-bold text-purple-600 mb-2">4.890</div>
                                <div className="text-gray-600 font-medium">Score Máximo</div>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
                            <div className="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-6">
                                <h3 className="text-2xl font-bold">🏆 TOP 20 Clínicas Dentales</h3>
                                <p className="text-gray-300">Ranking basado en análisis bayesiano</p>
                            </div>
                            
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-gray-100">
                                        <tr>
                                            <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">Rank</th>
                                            <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">Clínica</th>
                                            <th className="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider">Rating</th>
                                            <th className="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider">Reviews</th>
                                            <th className="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider">Score</th>
                                            <th className="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider">Cambio</th>
                                            <th className="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider">Acción</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {currentClinics.map((clinic) => {
                                            const changeInfo = getChangeIndicator(clinic.rank);
                                            return (
                                                <tr key={clinic.id} className="hover:bg-gray-50 transition-colors duration-200">
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="flex items-center space-x-2">
                                                            <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-lg ${getRankColor(clinic.rank)}`}>
                                                                {clinic.rank}
                                                            </div>
                                                            {clinic.rank === 1 && (
                                                                <div className="bg-yellow-100 border border-yellow-300 rounded-full px-2 py-1">
                                                                    <span className="text-yellow-800 text-xs font-bold">↗️ NUEVO #1</span>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div className="text-lg font-semibold text-gray-900">{clinic.name}</div>
                                                        <div className="text-sm text-gray-500">{clinic.direccion}</div>
                                                    </td>
                                                    <td className="px-6 py-4 text-center">
                                                        <div className="flex items-center justify-center mb-1">
                                                            {renderStars(clinic.rating)}
                                                        </div>
                                                        <div className="text-lg font-semibold text-gray-900">{clinic.rating}</div>
                                                    </td>
                                                    <td className="px-6 py-4 text-center">
                                                        <div className="text-2xl font-bold text-blue-600">{clinic.reviews}</div>
                                                    </td>
                                                    <td className="px-6 py-4 text-center">
                                                        <div className="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-3 py-1 rounded-full text-lg font-bold">
                                                            {clinic.score}
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4 text-center">
                                                        <div className="flex items-center justify-center space-x-1">
                                                            <div className={`${changeInfo.color} text-white px-2 py-1 rounded-full text-sm font-bold flex items-center space-x-1`}>
                                                                <span>{changeInfo.icon}</span>
                                                                <span>{changeInfo.text}</span>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4 text-center">
                                                        <button 
                                                            onClick={() => {
                                                                setSelectedClinic(clinic);
                                                                setShowClinicModal(true);
                                                            }}
                                                            className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors duration-200"
                                                        >
                                                            Ver
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>

                            <div className="bg-gray-50 px-6 py-4 flex items-center justify-between">
                                <button 
                                    onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
                                    disabled={currentPage === 1}
                                    className={`px-4 py-2 rounded-lg font-medium ${currentPage === 1 ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-blue-600 text-white hover:bg-blue-700'}`}
                                >
                                    Anterior
                                </button>
                                <span className="text-gray-700 font-medium">
                                    Página {currentPage} de {totalPages}
                                </span>
                                <button 
                                    onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}
                                    disabled={currentPage === totalPages}
                                    className={`px-4 py-2 rounded-lg font-medium ${currentPage === totalPages ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-blue-600 text-white hover:bg-blue-700'}`}
                                >
                                    Siguiente
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                                <div className="bg-blue-600 text-white p-4">
                                    <h4 className="text-xl font-bold flex items-center">
                                        <span className="mr-2">♿</span>
                                        Acceso Universal ({accesoUniversal.length})
                                    </h4>
                                </div>
                                <div className="max-h-80 overflow-y-auto">
                                    {accesoUniversal.slice(0, 12).map(clinic => (
                                        <div key={clinic.id} className="flex justify-between items-center p-4 border-b border-gray-100 hover:bg-blue-50 transition-colors">
                                            <div>
                                                <div className="font-semibold text-gray-900">{clinic.name}</div>
                                                <div className="text-sm text-gray-500">Score: {clinic.score}</div>
                                            </div>
                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold ${getRankColor(clinic.rank)}`}>
                                                {clinic.rank}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                                <div className="bg-green-600 text-white p-4">
                                    <h4 className="text-xl font-bold flex items-center">
